<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Architecture | Kaimon.jl</title>
    <meta name="description" content="Opening the gate between AI and Julia">
    <meta name="generator" content="VitePress v1.6.4">
    <link rel="preload stylesheet" href="/Kaimon.jl/dev/assets/style.BLO96-zp.css" as="style">
    <link rel="preload stylesheet" href="/Kaimon.jl/dev/vp-icons.css" as="style">
    
    <script type="module" src="/Kaimon.jl/dev/assets/app.CkG6GF68.js"></script>
    <link rel="preload" href="/Kaimon.jl/dev/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/Kaimon.jl/dev/assets/chunks/framework.CL3B3Tmm.js">
    <link rel="modulepreload" href="/Kaimon.jl/dev/assets/chunks/theme.CsFY1qm_.js">
    <link rel="modulepreload" href="/Kaimon.jl/dev/assets/chunks/katex.BlHpptmG.js">
    <link rel="modulepreload" href="/Kaimon.jl/dev/assets/chunks/dagre-6UL2VRFP.B8BGaLSv.js">
    <link rel="modulepreload" href="/Kaimon.jl/dev/assets/chunks/cose-bilkent-S5V4N54A.CSrRnNbg.js">
    <link rel="modulepreload" href="/Kaimon.jl/dev/assets/chunks/c4Diagram-YG6GDRKO.KQ3HJTMm.js">
    <link rel="modulepreload" href="/Kaimon.jl/dev/assets/chunks/flowDiagram-NV44I4VS.B701v1-S.js">
    <link rel="modulepreload" href="/Kaimon.jl/dev/assets/chunks/erDiagram-Q2GNP2WA.BjcUamf0.js">
    <link rel="modulepreload" href="/Kaimon.jl/dev/assets/chunks/gitGraphDiagram-V2S2FVAM.CCk2TMay.js">
    <link rel="modulepreload" href="/Kaimon.jl/dev/assets/chunks/ganttDiagram-JELNMOA3.BIcYn9en.js">
    <link rel="modulepreload" href="/Kaimon.jl/dev/assets/chunks/infoDiagram-HS3SLOUP.CbsgWChk.js">
    <link rel="modulepreload" href="/Kaimon.jl/dev/assets/chunks/pieDiagram-ADFJNKIX.BOu9mDDS.js">
    <link rel="modulepreload" href="/Kaimon.jl/dev/assets/chunks/quadrantDiagram-AYHSOK5B.DIGfALYg.js">
    <link rel="modulepreload" href="/Kaimon.jl/dev/assets/chunks/xychartDiagram-PRI3JC2R.4ND2MRYN.js">
    <link rel="modulepreload" href="/Kaimon.jl/dev/assets/chunks/requirementDiagram-UZGBJVZJ.BFeaPiQD.js">
    <link rel="modulepreload" href="/Kaimon.jl/dev/assets/chunks/sequenceDiagram-WL72ISMW.BdmmT2bg.js">
    <link rel="modulepreload" href="/Kaimon.jl/dev/assets/chunks/classDiagram-2ON5EDUG.Cc9Vda01.js">
    <link rel="modulepreload" href="/Kaimon.jl/dev/assets/chunks/classDiagram-v2-WZHVMYZB.Cc9Vda01.js">
    <link rel="modulepreload" href="/Kaimon.jl/dev/assets/chunks/stateDiagram-FKZM4ZOC.BcWbCSqX.js">
    <link rel="modulepreload" href="/Kaimon.jl/dev/assets/chunks/stateDiagram-v2-4FDKWEC3.pxdpGV-B.js">
    <link rel="modulepreload" href="/Kaimon.jl/dev/assets/chunks/journeyDiagram-XKPGCS4Q.4RKQv54z.js">
    <link rel="modulepreload" href="/Kaimon.jl/dev/assets/chunks/timeline-definition-IT6M3QCI.bR9E1XPo.js">
    <link rel="modulepreload" href="/Kaimon.jl/dev/assets/chunks/mindmap-definition-VGOIOE7T.DNhxlHac.js">
    <link rel="modulepreload" href="/Kaimon.jl/dev/assets/chunks/kanban-definition-3W4ZIXB7.QttvGMXh.js">
    <link rel="modulepreload" href="/Kaimon.jl/dev/assets/chunks/sankeyDiagram-TZEHDZUN.BoHc3f6j.js">
    <link rel="modulepreload" href="/Kaimon.jl/dev/assets/chunks/diagram-S2PKOQOG.C_Yje-92.js">
    <link rel="modulepreload" href="/Kaimon.jl/dev/assets/chunks/diagram-QEK2KX5R.D7U_QwwR.js">
    <link rel="modulepreload" href="/Kaimon.jl/dev/assets/chunks/blockDiagram-VD42YOAC.DoujnFZP.js">
    <link rel="modulepreload" href="/Kaimon.jl/dev/assets/chunks/architectureDiagram-VXUJARFQ.1EA0iju3.js">
    <link rel="modulepreload" href="/Kaimon.jl/dev/assets/chunks/diagram-PSM6KHXK.DaAsieLw.js">
    <link rel="modulepreload" href="/Kaimon.jl/dev/assets/chunks/virtual_mermaid-config.DDnGl6nM.js">
    <link rel="modulepreload" href="/Kaimon.jl/dev/assets/architecture.md.txv_QW_4.lean.js">
    <link rel="icon" href="/Kaimon.jl/assets/kaimon_logo1.png">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-a9a9e638><!--[--><!--]--><!--[--><span tabindex="-1" data-v-492508fc></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-492508fc>Skip to content</a><!--]--><!----><header class="VPNav" data-v-a9a9e638 data-v-f1e365da><div class="VPNavBar" data-v-f1e365da data-v-822684d1><div class="wrapper" data-v-822684d1><div class="container" data-v-822684d1><div class="title" data-v-822684d1><div class="VPNavBarTitle has-sidebar" data-v-822684d1 data-v-0f4f798b><a class="title" href="/Kaimon.jl/dev/" data-v-0f4f798b><!--[--><!--]--><!--[--><img class="VPImage logo" src="/Kaimon.jl/dev/assets/kaimon_logo1.png" alt data-v-35a7d0b8><!--]--><span data-v-0f4f798b>Kaimon.jl</span><!--[--><!--]--></a></div></div><div class="content" data-v-822684d1><div class="content-body" data-v-822684d1><!--[--><!--]--><div class="VPNavBarSearch search" data-v-822684d1><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-822684d1 data-v-e6d46098><span id="main-nav-aria-label" class="visually-hidden" data-v-e6d46098> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/Kaimon.jl/dev/getting-started" tabindex="0" data-v-e6d46098 data-v-956ec74c><!--[--><span data-v-956ec74c>Guide</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/Kaimon.jl/dev/tools" tabindex="0" data-v-e6d46098 data-v-956ec74c><!--[--><span data-v-956ec74c>Tools</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/Kaimon.jl/dev/api" tabindex="0" data-v-e6d46098 data-v-956ec74c><!--[--><span data-v-956ec74c>API</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-822684d1 data-v-af096f4a><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-af096f4a data-v-e40a8bb6 data-v-4a1c76db><span class="check" data-v-4a1c76db><span class="icon" data-v-4a1c76db><!--[--><span class="vpi-sun sun" data-v-e40a8bb6></span><span class="vpi-moon moon" data-v-e40a8bb6></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-822684d1 data-v-164c457f data-v-ee7a9424><!--[--><a class="VPSocialLink no-icon" href="https://github.com/kahliburke/Kaimon.jl" aria-label="github" target="_blank" rel="noopener" data-v-ee7a9424 data-v-d26d30cb><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-822684d1 data-v-925effce data-v-04f5c5e9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-04f5c5e9><span class="vpi-more-horizontal icon" data-v-04f5c5e9></span></button><div class="menu" data-v-04f5c5e9><div class="VPMenu" data-v-04f5c5e9 data-v-7dd3104a><!----><!--[--><!--[--><!----><div class="group" data-v-925effce><div class="item appearance" data-v-925effce><p class="label" data-v-925effce>Appearance</p><div class="appearance-action" data-v-925effce><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-925effce data-v-e40a8bb6 data-v-4a1c76db><span class="check" data-v-4a1c76db><span class="icon" data-v-4a1c76db><!--[--><span class="vpi-sun sun" data-v-e40a8bb6></span><span class="vpi-moon moon" data-v-e40a8bb6></span><!--]--></span></span></button></div></div></div><div class="group" data-v-925effce><div class="item social-links" data-v-925effce><div class="VPSocialLinks social-links-list" data-v-925effce data-v-ee7a9424><!--[--><a class="VPSocialLink no-icon" href="https://github.com/kahliburke/Kaimon.jl" aria-label="github" target="_blank" rel="noopener" data-v-ee7a9424 data-v-d26d30cb><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-822684d1 data-v-5dea55bf><span class="container" data-v-5dea55bf><span class="top" data-v-5dea55bf></span><span class="middle" data-v-5dea55bf></span><span class="bottom" data-v-5dea55bf></span></span></button></div></div></div></div><div class="divider" data-v-822684d1><div class="divider-line" data-v-822684d1></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-a9a9e638 data-v-070ab83d><div class="container" data-v-070ab83d><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-070ab83d><span class="vpi-align-left menu-icon" data-v-070ab83d></span><span class="menu-text" data-v-070ab83d>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-070ab83d data-v-168ddf5d><button data-v-168ddf5d>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-a9a9e638 data-v-18756405><div class="curtain" data-v-18756405></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-18756405><span class="visually-hidden" id="sidebar-aria-label" data-v-18756405> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-9e426adc><section class="VPSidebarItem level-0 has-active" data-v-9e426adc data-v-a4b0d9bf><div class="item" role="button" tabindex="0" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><h2 class="text" data-v-a4b0d9bf>Introduction</h2><!----></div><div class="items" data-v-a4b0d9bf><!--[--><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/Kaimon.jl/dev/installation" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Installation</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/Kaimon.jl/dev/getting-started" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Getting Started</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/Kaimon.jl/dev/architecture" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Architecture</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-9e426adc><section class="VPSidebarItem level-0" data-v-9e426adc data-v-a4b0d9bf><div class="item" role="button" tabindex="0" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><h2 class="text" data-v-a4b0d9bf>Guide</h2><!----></div><div class="items" data-v-a4b0d9bf><!--[--><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/Kaimon.jl/dev/usage" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Usage</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/Kaimon.jl/dev/tools" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Tool Catalog</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/Kaimon.jl/dev/gate" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>The Gate</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/Kaimon.jl/dev/sessions" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Sessions</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/Kaimon.jl/dev/search" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Semantic Search</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/Kaimon.jl/dev/security" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Security</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/Kaimon.jl/dev/vscode" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>VS Code</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/Kaimon.jl/dev/configuration" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Configuration</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-9e426adc><section class="VPSidebarItem level-0" data-v-9e426adc data-v-a4b0d9bf><div class="item" role="button" tabindex="0" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><h2 class="text" data-v-a4b0d9bf>Reference</h2><!----></div><div class="items" data-v-a4b0d9bf><!--[--><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/Kaimon.jl/dev/api" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>API Reference</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-a9a9e638 data-v-91765379><div class="VPDoc has-sidebar has-aside" data-v-91765379 data-v-83890dd9><!--[--><!--]--><div class="container" data-v-83890dd9><div class="aside" data-v-83890dd9><div class="aside-curtain" data-v-83890dd9></div><div class="aside-container" data-v-83890dd9><div class="aside-content" data-v-83890dd9><div class="VPDocAside" data-v-83890dd9 data-v-6d7b3c46><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-6d7b3c46 data-v-b38bf2ff><div class="content" data-v-b38bf2ff><div class="outline-marker" data-v-b38bf2ff></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-b38bf2ff>On this page</div><ul class="VPDocOutlineItem root" data-v-b38bf2ff data-v-3f927ebe><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-6d7b3c46></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-83890dd9><div class="content-container" data-v-83890dd9><!--[--><!--]--><main class="main" data-v-83890dd9><div style="position:relative;" class="vp-doc _Kaimon_jl_dev_architecture" data-v-83890dd9><div><h1 id="architecture" tabindex="-1">Architecture <a class="header-anchor" href="#architecture" aria-label="Permalink to &quot;Architecture&quot;">​</a></h1><p>Kaimon exposes Julia REPLs as MCP (Model Context Protocol) servers for AI agents. This document describes the system architecture, communication protocols, and key modules.</p><h2 id="System-Overview" tabindex="-1">System Overview <a class="header-anchor" href="#System-Overview" aria-label="Permalink to &quot;System Overview {#System-Overview}&quot;">​</a></h2><div class="mermaid"></div><p>MCP clients communicate with the Kaimon server over HTTP. The server routes tool calls either to its own process (standalone mode) or through ZMQ IPC sockets to external Julia REPLs (TUI/gate mode).</p><h2 id="MCP-Protocol-Layer" tabindex="-1">MCP Protocol Layer <a class="header-anchor" href="#MCP-Protocol-Layer" aria-label="Permalink to &quot;MCP Protocol Layer {#MCP-Protocol-Layer}&quot;">​</a></h2><p>Kaimon implements the <a href="https://modelcontextprotocol.io/specification/2025-03-26/basic/transports#streamable-http" target="_blank" rel="noreferrer">MCP Streamable HTTP transport</a>. All communication uses JSON-RPC 2.0 over HTTP POST.</p><h3 id="endpoints" tabindex="-1">Endpoints <a class="header-anchor" href="#endpoints" aria-label="Permalink to &quot;Endpoints&quot;">​</a></h3><table tabindex="0"><thead><tr><th style="text-align:right;">Path</th><th style="text-align:right;">Method</th><th style="text-align:right;">Description</th></tr></thead><tbody><tr><td style="text-align:right;"><code>/</code> or <code>/mcp</code></td><td style="text-align:right;">POST</td><td style="text-align:right;">JSON-RPC requests (tool calls, initialize, etc.)</td></tr><tr><td style="text-align:right;"><code>/vscode-response</code></td><td style="text-align:right;">POST</td><td style="text-align:right;">Bidirectional VS Code command responses</td></tr><tr><td style="text-align:right;"><code>/.well-known/agents.md</code></td><td style="text-align:right;">GET</td><td style="text-align:right;">Project AGENTS.md file</td></tr></tbody></table><h3 id="Request-Lifecycle" tabindex="-1">Request Lifecycle <a class="header-anchor" href="#Request-Lifecycle" aria-label="Permalink to &quot;Request Lifecycle {#Request-Lifecycle}&quot;">​</a></h3><ol><li><p>Client sends a JSON-RPC POST with <code>Mcp-Session-Id</code> header.</p></li><li><p>Server resolves or creates an <code>MCPSession</code> from the header.</p></li><li><p>For <code>tools/call</code> requests, the server looks up the tool by name and dispatches to its handler.</p></li><li><p>In gate mode, long-running tool calls (like <code>ex</code>) use SSE streaming: the response is <code>Content-Type: text/event-stream</code> with <code>notifications/progress</code> events followed by the final JSON-RPC result.</p></li><li><p>Non-streaming responses return <code>Content-Type: application/json</code>.</p></li></ol><h3 id="Session-Management" tabindex="-1">Session Management <a class="header-anchor" href="#Session-Management" aria-label="Permalink to &quot;Session Management {#Session-Management}&quot;">​</a></h3><p>Each MCP client connection is tracked as an <code>MCPSession</code> with states:</p><ul><li><p><strong>UNINITIALIZED</strong> – Session created, awaiting <code>initialize</code> request.</p></li><li><p><strong>INITIALIZED</strong> – Protocol version negotiated, ready for tool calls.</p></li><li><p><strong>CLOSED</strong> – Session terminated.</p></li></ul><p>Sessions are persisted to <code>~/.cache/kaimon/sessions.json</code> so clients can reconnect after a server restart without re-initializing.</p><h2 id="Kaimon-Server" tabindex="-1">Kaimon Server <a class="header-anchor" href="#Kaimon-Server" aria-label="Permalink to &quot;Kaimon Server {#Kaimon-Server}&quot;">​</a></h2><p>The server (<code>src/MCPServer.jl</code>) is an HTTP.jl server that handles:</p><ul><li><p><strong>Tool routing</strong> – Maintains a <code>Dict{Symbol, MCPTool}</code> registry mapping tool IDs to handlers. Tools are defined with the <code>@mcp_tool</code> macro or assembled by <code>collect_tools()</code>.</p></li><li><p><strong>Session management</strong> – Per-request session lookup via the <code>Mcp-Session-Id</code> header, with automatic creation for clients that skip initialization.</p></li><li><p><strong>Security enforcement</strong> – Every request passes through API key and IP validation before reaching the handler.</p></li><li><p><strong>SSE streaming</strong> – For gate-mode tool calls that may run for seconds or minutes, the server streams progress notifications as SSE events with a 5-second heartbeat to prevent connection timeouts.</p></li><li><p><strong>Dynamic tool registration</strong> – Tools can be registered and unregistered at runtime (e.g., when a gate session connects with custom tools). The server sends <code>notifications/tools/list_changed</code> so clients refresh their tool list.</p></li></ul><h3 id="Standalone-vs.-TUI-Mode" tabindex="-1">Standalone vs. TUI Mode <a class="header-anchor" href="#Standalone-vs.-TUI-Mode" aria-label="Permalink to &quot;Standalone vs. TUI Mode {#Standalone-vs.-TUI-Mode}&quot;">​</a></h3><table tabindex="0"><thead><tr><th style="text-align:right;"></th><th style="text-align:right;">Standalone (<code>start!()</code>)</th><th style="text-align:right;">TUI (<code>tui()</code>)</th></tr></thead><tbody><tr><td style="text-align:right;">Process model</td><td style="text-align:right;">Server + REPL in one process</td><td style="text-align:right;">Server in TUI process, REPLs connect via Gate</td></tr><tr><td style="text-align:right;">Code execution</td><td style="text-align:right;">Direct <code>Core.eval(Main, expr)</code></td><td style="text-align:right;">Forwarded over ZMQ to external REPL</td></tr><tr><td style="text-align:right;">Default port</td><td style="text-align:right;">From config (dynamic)</td><td style="text-align:right;">2828</td></tr><tr><td style="text-align:right;">Dashboard</td><td style="text-align:right;">None (REPL prompt indicator)</td><td style="text-align:right;">Full terminal UI</td></tr><tr><td style="text-align:right;">Multi-session</td><td style="text-align:right;">Single REPL</td><td style="text-align:right;">Multiple REPLs via Gate</td></tr></tbody></table><h2 id="The-Gate-Module" tabindex="-1">The Gate Module <a class="header-anchor" href="#The-Gate-Module" aria-label="Permalink to &quot;The Gate Module {#The-Gate-Module}&quot;">​</a></h2><p>The Gate (<code>src/gate.jl</code>) is the bridge between the Kaimon server and external Julia processes.</p><h3 id="Gate-Server-REPL-side" tabindex="-1">Gate Server (REPL side) <a class="header-anchor" href="#Gate-Server-REPL-side" aria-label="Permalink to &quot;Gate Server (REPL side) {#Gate-Server-REPL-side}&quot;">​</a></h3><p><code>Gate.serve()</code> runs inside the user&#39;s Julia REPL. It:</p><ol><li><p>Binds a ZMQ REP socket at <code>~/.cache/kaimon/sock/&lt;session-id&gt;.sock</code>.</p></li><li><p>Opens a ZMQ PUB socket for streaming stdout/stderr during eval.</p></li><li><p>Enters a message loop that handles requests:</p></li></ol><ul><li><p><code>:eval</code> / <code>:eval_async</code> – Evaluate Julia code, capturing stdout, stderr, return value, and exceptions.</p></li><li><p><code>:ping</code> – Health check returning session metadata, Revise status, project path, Julia version, PID, and registered tool metadata.</p></li><li><p><code>:restart</code> – Restart the Julia process via <code>execvp</code>, preserving the session ID so the TUI reconnects automatically.</p></li><li><p><code>:tool_call</code> – Dispatch to a session-scoped <code>GateTool</code> handler.</p></li></ul><h3 id="Gate-Client-TUI-side" tabindex="-1">Gate Client (TUI side) <a class="header-anchor" href="#Gate-Client-TUI-side" aria-label="Permalink to &quot;Gate Client (TUI side) {#Gate-Client-TUI-side}&quot;">​</a></h3><p>The <code>ConnectionManager</code> (<code>src/gate_client.jl</code>) runs inside the Kaimon TUI process. It:</p><ol><li><p>Watches <code>~/.cache/kaimon/sock/</code> for new <code>.sock</code> files.</p></li><li><p>Connects a ZMQ REQ socket to each discovered gate.</p></li><li><p>Maintains <code>REPLConnection</code> objects with health status, project metadata, and tool call counts.</p></li><li><p>Provides <code>eval_remote()</code> and <code>eval_remote_async()</code> for sending code to specific sessions.</p></li></ol><h3 id="Session-Scoped-Tools-GateTool" tabindex="-1">Session-Scoped Tools (GateTool) <a class="header-anchor" href="#Session-Scoped-Tools-GateTool" aria-label="Permalink to &quot;Session-Scoped Tools (GateTool) {#Session-Scoped-Tools-GateTool}&quot;">​</a></h3><p>Gate sessions can register custom tools:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Gate</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">serve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(tools</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[Gate</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">GateTool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;my_tool&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, my_handler)])</span></span></code></pre></div><p>The Gate reflects on the handler function&#39;s type signature using Julia&#39;s reflection APIs (<code>methods</code>, <code>fieldnames</code>, <code>fieldtypes</code>) to generate MCP JSON Schema automatically. This includes support for:</p><ul><li><p>Primitive types (String, Int, Float64, Bool)</p></li><li><p>Enums (mapped to JSON Schema <code>enum</code>)</p></li><li><p>Structs (mapped to JSON Schema <code>object</code> with typed fields)</p></li><li><p><code>Union{T, Nothing}</code> (marks the parameter as optional)</p></li><li><p>Vectors (mapped to JSON Schema <code>array</code> with element type)</p></li></ul><p>When a gate session connects, the TUI registers its tools into the MCP server&#39;s tool registry and sends <code>notifications/tools/list_changed</code>.</p><h2 id="TUI-Architecture" tabindex="-1">TUI Architecture <a class="header-anchor" href="#TUI-Architecture" aria-label="Permalink to &quot;TUI Architecture {#TUI-Architecture}&quot;">​</a></h2><p>The terminal dashboard (<code>src/tui.jl</code> and <code>src/tui/</code>) is built on <a href="https://github.com/kburke/Tachikoma.jl" target="_blank" rel="noreferrer">Tachikoma.jl</a>, a Julia TUI framework. It follows the Elm architecture:</p><div class="mermaid"></div><ul><li><p><strong>Model</strong> (<code>KaimonModel</code> in <code>src/tui/types.jl</code>) – All application state: connection manager, server status, activity log, in-flight tool calls, search index state, configuration flow state.</p></li><li><p><strong>update!</strong> (<code>src/tui/update.jl</code>) – Handles keyboard events, tick events (polling gate health, processing reindex queues), and background task results.</p></li><li><p><strong>view</strong> (<code>src/tui/view.jl</code>) – Renders the model into Tachikoma widgets (Block, TabBar, Table, SelectableList, StatusBar, Modal, etc.) that produce a terminal frame at 30 fps.</p></li></ul><p>The TUI has several tabs:</p><ul><li><p><strong>Sessions</strong> – Connected REPL gates with status and metadata.</p></li><li><p><strong>Activity</strong> – Live tool call feed with in-flight progress tracking.</p></li><li><p><strong>Server</strong> – MCP server logs and configuration.</p></li><li><p><strong>Search</strong> – Qdrant vector search index management.</p></li><li><p><strong>Config</strong> – Security and client configuration.</p></li><li><p><strong>Advanced</strong> – Debug and diagnostics.</p></li></ul><h3 id="Hot-Reload" tabindex="-1">Hot Reload <a class="header-anchor" href="#Hot-Reload" aria-label="Permalink to &quot;Hot Reload {#Hot-Reload}&quot;">​</a></h3><p>The TUI supports Revise.jl hot reloading via <code>Ctrl-U</code>. The app loop exits, calls <code>Revise.revise()</code>, and re-enters <code>app()</code> with <code>Base.invokelatest</code> so updated <code>view()</code> and <code>update!()</code> methods take effect without restarting.</p><h2 id="Security-Layer" tabindex="-1">Security Layer <a class="header-anchor" href="#Security-Layer" aria-label="Permalink to &quot;Security Layer {#Security-Layer}&quot;">​</a></h2><p>Security is configured in <code>~/.config/kaimon/security.json</code> (global) or <code>.kaimon/security.json</code> (per-project). The configuration defines:</p><h3 id="Three-Security-Modes" tabindex="-1">Three Security Modes <a class="header-anchor" href="#Three-Security-Modes" aria-label="Permalink to &quot;Three Security Modes {#Three-Security-Modes}&quot;">​</a></h3><table tabindex="0"><thead><tr><th style="text-align:right;">Mode</th><th style="text-align:right;">API Key Required</th><th style="text-align:right;">IP Allowlist Enforced</th><th style="text-align:right;">Use Case</th></tr></thead><tbody><tr><td style="text-align:right;"><code>strict</code></td><td style="text-align:right;">Yes</td><td style="text-align:right;">Yes</td><td style="text-align:right;">Production, shared machines</td></tr><tr><td style="text-align:right;"><code>relaxed</code></td><td style="text-align:right;">Yes</td><td style="text-align:right;">No</td><td style="text-align:right;">Local development with auth</td></tr><tr><td style="text-align:right;"><code>lax</code></td><td style="text-align:right;">No</td><td style="text-align:right;">No</td><td style="text-align:right;">Trusted local-only setups</td></tr></tbody></table><h3 id="Authentication-Flow" tabindex="-1">Authentication Flow <a class="header-anchor" href="#Authentication-Flow" aria-label="Permalink to &quot;Authentication Flow {#Authentication-Flow}&quot;">​</a></h3><ol><li><p>Extract <code>Authorization: Bearer &lt;key&gt;</code> from the request header.</p></li><li><p>Validate the key against the configured <code>api_keys</code> list.</p></li><li><p>In <code>strict</code> mode, also validate the client IP against <code>allowed_ips</code> (defaults to <code>127.0.0.1</code> and <code>::1</code>).</p></li><li><p>For VS Code bidirectional communication, single-use cryptographic nonces replace API keys to prevent replay attacks.</p></li></ol><h3 id="API-Key-Format" tabindex="-1">API Key Format <a class="header-anchor" href="#API-Key-Format" aria-label="Permalink to &quot;API Key Format {#API-Key-Format}&quot;">​</a></h3><p>Keys follow the pattern <code>kaimon_&lt;40 hex chars&gt;</code> (160-bit entropy). They are generated by <code>Kaimon.generate_key()</code> or during the setup wizard.</p><h2 id="Key-File-Locations" tabindex="-1">Key File Locations <a class="header-anchor" href="#Key-File-Locations" aria-label="Permalink to &quot;Key File Locations {#Key-File-Locations}&quot;">​</a></h2><table tabindex="0"><thead><tr><th style="text-align:right;">Path</th><th style="text-align:right;">Purpose</th></tr></thead><tbody><tr><td style="text-align:right;"><code>~/.config/kaimon/security.json</code></td><td style="text-align:right;">Global security configuration</td></tr><tr><td style="text-align:right;"><code>.kaimon/security.json</code></td><td style="text-align:right;">Per-project security override</td></tr><tr><td style="text-align:right;"><code>.kaimon/tools.json</code></td><td style="text-align:right;">Per-project tool enable/disable config</td></tr><tr><td style="text-align:right;"><code>~/.cache/kaimon/sock/</code></td><td style="text-align:right;">ZMQ IPC socket files for gate connections</td></tr><tr><td style="text-align:right;"><code>~/.cache/kaimon/sessions.json</code></td><td style="text-align:right;">Persisted MCP session state</td></tr><tr><td style="text-align:right;"><code>~/.cache/kaimon/</code></td><td style="text-align:right;">Logs, database, and other operational files</td></tr></tbody></table></div></div></main><footer class="VPDocFooter" data-v-83890dd9 data-v-4f9813fa><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-4f9813fa><span class="visually-hidden" id="doc-footer-aria-label" data-v-4f9813fa>Pager</span><div class="pager" data-v-4f9813fa><a class="VPLink link pager-link prev" href="/Kaimon.jl/dev/getting-started" data-v-4f9813fa><!--[--><span class="desc" data-v-4f9813fa>Previous page</span><span class="title" data-v-4f9813fa>Getting Started</span><!--]--></a></div><div class="pager" data-v-4f9813fa><a class="VPLink link pager-link next" href="/Kaimon.jl/dev/usage" data-v-4f9813fa><!--[--><span class="desc" data-v-4f9813fa>Next page</span><span class="title" data-v-4f9813fa>Usage</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-a9a9e638 data-v-c970a860><div class="container" data-v-c970a860><p class="message" data-v-c970a860>Made with <a href="https://documenter.juliadocs.org/stable/">Documenter.jl</a> and <a href="https://vitepress.dev">VitePress</a></p><p class="copyright" data-v-c970a860>Copyright © 2025-present</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"api.md\":\"DzBmMg0O\",\"architecture.md\":\"txv_QW_4\",\"configuration.md\":\"ByCO2j1k\",\"gate.md\":\"BMyGO-Wp\",\"getting-started.md\":\"B24TaxBj\",\"index.md\":\"KCVjkF_-\",\"installation.md\":\"DFpSrv5c\",\"search.md\":\"ConTDBUu\",\"security.md\":\"ChTWIQ5h\",\"sessions.md\":\"ljlyDAfq\",\"tools.md\":\"ClI9he0I\",\"usage.md\":\"CqvuXZ84\",\"vscode.md\":\"DFJwbSNj\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Kaimon.jl\",\"description\":\"Opening the gate between AI and Julia\",\"base\":\"/Kaimon.jl/dev/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"logo\":\"/assets/kaimon_logo1.png\",\"nav\":[{\"text\":\"Guide\",\"link\":\"/getting-started\"},{\"text\":\"Tools\",\"link\":\"/tools\"},{\"text\":\"API\",\"link\":\"/api\"}],\"sidebar\":[{\"text\":\"Introduction\",\"items\":[{\"text\":\"Installation\",\"link\":\"/installation\"},{\"text\":\"Getting Started\",\"link\":\"/getting-started\"},{\"text\":\"Architecture\",\"link\":\"/architecture\"}]},{\"text\":\"Guide\",\"items\":[{\"text\":\"Usage\",\"link\":\"/usage\"},{\"text\":\"Tool Catalog\",\"link\":\"/tools\"},{\"text\":\"The Gate\",\"link\":\"/gate\"},{\"text\":\"Sessions\",\"link\":\"/sessions\"},{\"text\":\"Semantic Search\",\"link\":\"/search\"},{\"text\":\"Security\",\"link\":\"/security\"},{\"text\":\"VS Code\",\"link\":\"/vscode\"},{\"text\":\"Configuration\",\"link\":\"/configuration\"}]},{\"text\":\"Reference\",\"items\":[{\"text\":\"API Reference\",\"link\":\"/api\"}]}],\"outline\":{\"level\":[2,3]},\"search\":{\"provider\":\"local\"},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/kahliburke/Kaimon.jl\"}],\"footer\":{\"message\":\"Made with <a href=\\\"https://documenter.juliadocs.org/stable/\\\">Documenter.jl</a> and <a href=\\\"https://vitepress.dev\\\">VitePress</a>\",\"copyright\":\"Copyright © 2025-present\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":true}");</script>
    
  </body>
</html>